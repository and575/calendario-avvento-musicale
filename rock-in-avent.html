<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Calendario dell‚ÄôAvvento Musicale ‚Äì Sorpresa</title>
  <style>
    body{
      font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;
      background:#f5f7fa;
      color:#111827;
      margin:0;
      padding:20px;
    }
    h1{
      text-align:center;
      margin-bottom:4px;
      color:#111827;
    }
    .subtitle{
      text-align:center;
      font-size:0.95rem;
      color:#6b7280;
      margin-bottom:28px;
    }
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
      gap:16px;
      max-width:960px;
      margin:0 auto 30px;
    }
    .cell{
      position:relative;
      background:#ffffff;
      border-radius:16px;
      padding:16px 14px 14px;
      border:1px solid #e5e7eb;
      box-shadow:0 10px 25px rgba(15,23,42,0.06);
      overflow:hidden;
      min-height:140px;
      display:flex;
      flex-direction:column;
      justify-content:flex-start;
      align-items:stretch;
    }
    .day-number{
      font-size:1.2rem;
      font-weight:700;
      color:#6b7280;
      margin-bottom:8px;
    }
    .door-content{
      opacity:0;
      transform:translateY(6px);
      transition:opacity 0.2s ease, transform 0.2s ease;
      font-size:0.9rem;
    }
    .cell.open .door-content{
      opacity:1;
      transform:translateY(0);
    }
    .title{
      font-weight:600;
      color:#111827;
      margin-bottom:2px;
    }
    .artist{
      color:#ef4444;
      font-size:0.9rem;
      margin-bottom:6px;
    }
    .proposed-by{
      font-size:0.78rem;
      color:#9ca3af;
      margin-bottom:4px;
    }
    .listen-link{
      display:inline-block;
      margin-top:4px;
      font-size:0.85rem;
      font-weight:600;
      text-decoration:none;
      color:#2563eb;
    }
    .listen-link:hover{
      text-decoration:underline;
    }

    /* Porta ‚Äúcoperta‚Äù */
    .door{
      position:absolute;
      inset:0;
      border:none;
      cursor:pointer;
      background:linear-gradient(145deg,#111827,#1f2937);
      color:#f9fafb;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:1.4rem;
      font-weight:700;
      letter-spacing:0.06em;
      text-transform:uppercase;
      transition:transform 0.28s ease, opacity 0.28s ease, box-shadow 0.2s ease, background 0.2s ease;
      box-shadow:0 18px 40px rgba(15,23,42,0.45);
      border-radius:16px;
    }
    .door:hover:not(.door-locked):not(:disabled){
      transform:translateY(-2px);
      box-shadow:0 22px 55px rgba(15,23,42,0.6);
      background:linear-gradient(145deg,#1f2937,#111827);
    }
    .door:active:not(.door-locked):not(:disabled){
      transform:translateY(0);
      box-shadow:0 14px 30px rgba(15,23,42,0.4);
    }

    /* Porta aperta (oggi dopo il click, o giorni passati) */
    .door-open{
      opacity:0;
      pointer-events:none;
    }

    /* Giorni futuri: bloccati */
    .door-locked{
      cursor:default;
      background:repeating-linear-gradient(
        45deg,
        #111827,
        #111827 8px,
        #1f2937 8px,
        #1f2937 16px
      );
      font-size:1.1rem;
      letter-spacing:0.12em;
    }

    .cell.open .door{
      opacity:0;
      pointer-events:none;
    }

    .empty{
      font-size:0.8rem;
      color:#9ca3af;
    }

    .notice{
      text-align:center;
      font-size:0.8rem;
      color:#9ca3af;
      max-width:620px;
      margin:0 auto;
    }

    #status{
      text-align:center;
      font-size:0.85rem;
      color:#6b7280;
      margin-bottom:14px;
    }

    @media (max-width:600px){
      body{padding:16px;}
      .cell{min-height:130px;}
    }
  </style>
</head>
<body>
  <h1>Calendario dell‚ÄôAvvento Musicale</h1>
  <p class="subtitle">
    Le caselle future restano chiuse. Ogni giorno si sblocca solo la casella di oggi.
  </p>

  <p id="status">Caricamento in corso‚Ä¶</p>

  <div id="calendar" class="grid"></div>

  <p class="notice">
    I brani sono caricati dal foglio Google collegato (una riga per giorno:
    <strong>Giorno, Titolo, Artista, Proposto da, URL</strong>).
  </p>

  <script>
    // üëâ Sostituisci con l'URL CSV pubblicato del tuo secondo foglio
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRqcYY8zIGx9HtwbeLBpq_1nGVdPIOA5Sb-GiMkc--Prmh0UXiJJHq1_HrjqWZTqMxM48aJH0XLfjKM/pub?gid=0&single=true&output=csv';

    function parseCSV(text){
  const rows = text.trim().split('\n');
  if (rows.length === 0) return [];

  // prima riga: intestazioni (Giorno,Titolo,Artista,Proposto da,URL)
  const headers = rows[0].split(',').map(h =>
    h.replace(/^"|"$/g, '').trim()
  );

  // righe successive: dati
  return rows.slice(1).map(line => {
    const cols = line.split(',');
    const obj = {};
    headers.forEach((h, i) => {
      obj[h] = (cols[i] || '').replace(/^"|"$/g, '').trim();
    });
    return obj;
  });
}

    async function renderCalendar(){
      const statusEl = document.getElementById('status');
      const container = document.getElementById('calendar');

      try{
        const resp = await fetch(csvUrl);
        if (!resp.ok) throw new Error('HTTP ' + resp.status);
        const data = parseCSV(await resp.text());

        // Mappa giorno ‚Üí riga
        const byDay = {};
        data.forEach(row => {
          const d = parseInt(row['Giorno'], 10);
          if (!isNaN(d)) byDay[d] = row;
        });

        // Giorno corrente (del browser dell‚Äôutente)
        const now = new Date();
        const todayDay = now.getDate();      // 1‚Äì31
        const todayMonth = now.getMonth();   // 0‚Äì11 (0 = gennaio, 11 = dicembre)

        // Se vuoi limitare a dicembre puoi attivare questo controllo:
        // if (todayMonth !== 11) { /* logica alternativa */ }

        container.innerHTML = '';
        const MAX_DAY = 24;   // classico calendario Avvento

        for (let day = 1; day <= MAX_DAY; day++){
          const info = byDay[day];
          const cell = document.createElement('div');
          cell.className = 'cell';

          const dayEl = document.createElement('div');
          dayEl.className = 'day-number';
          dayEl.textContent = 'Giorno ' + day;
          cell.appendChild(dayEl);

          const content = document.createElement('div');
          content.className = 'door-content';

          if (info){
            const titolo = info['Titolo'] || '';
            const artista = info['Artista'] || '';
            const proposto = info['Proposto da'] || '';
            const url = info['URL'] || '';

            content.innerHTML = `
              <div class="title">${titolo}</div>
              <div class="artist">${artista}</div>
              ${proposto ? `<div class="proposed-by">Proposto da: ${proposto}</div>` : ''}
              ${url ? `<a class="listen-link" href="${url}" target="_blank" rel="noopener">Ascolta il brano</a>` : ''}
            `;
          } else {
            content.innerHTML = `<div class="empty">Nessun brano inserito per questo giorno.</div>`;
          }

          cell.appendChild(content);

          const door = document.createElement('button');
          door.type = 'button';
          door.className = 'door';
          door.textContent = '‚òÖ';

          if (day < todayDay){
            // Giorni passati: gi√† aperti
            cell.classList.add('open');
            door.classList.add('door-open');
          } else if (day === todayDay){
            // Oggi: coperto, ma apribile
            door.textContent = 'Apri';
            door.addEventListener('click', () => {
              cell.classList.add('open');
              door.classList.add('door-open');
              door.disabled = true;
            });
          } else {
            // Giorni futuri: bloccati, non cliccabili
            door.classList.add('door-locked');
            door.disabled = true;
            door.textContent = '‚ú∂';
            door.title = 'Disponibile il ' + day + ' dicembre';
          }

          cell.appendChild(door);
          container.appendChild(cell);
        }

        statusEl.textContent = '';
      } catch(err){
        console.error(err);
        statusEl.textContent = 'Impossibile caricare il calendario. Controlla l‚ÄôURL del CSV.';
        statusEl.style.color = '#b91c1c';
      }
    }

    window.addEventListener('DOMContentLoaded', renderCalendar);
  </script>
</body>
</html>


