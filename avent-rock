<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Rock in Avent – Calendrier musical</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root{
      --bg-body:#030712;
      --bg-panel:#020617;
      --accent:#f97316;
      --accent-soft:#fed7aa;
      --text-main:#e5e7eb;
      --text-muted:#9ca3af;
      --border:#1f2937;
    }

    *{
      box-sizing:border-box;
    }

    body{
      margin:0;
      padding:20px 10px 28px;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",system-ui,sans-serif;
      background:radial-gradient(circle at top,#111827 0,#020617 45%,#000 100%);
      color:var(--text-main);
    }
    .back-home{
  display:inline-flex;
  align-items:center;
  gap:6px;
  font-size:.85rem;
  color:#e5e7eb;
  text-decoration:none;
  padding:6px 10px;
  border-radius:999px;
  background:rgba(15,23,42,0.85);
  border:1px solid #374151;
  margin-bottom:10px;
  box-shadow:0 6px 16px rgba(15,23,42,0.7);
}
.back-home:hover{
  background:rgba(31,41,55,0.95);
}
.back-home span.icon{
  font-size:1rem;
}
    .page{
      max-width:900px;
      margin:0 auto;
    }
 .page-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
  margin-bottom:6px;
  flex-wrap:wrap; /* così su schermi piccoli può andare a capo in modo pulito */
}

.page-header h1{
  margin:0;
}

/* Bottone "torna alla home" */
.back-home{
  display:inline-flex;
  align-items:center;
  gap:6px;
  font-size:.8rem;
  color:#e5e7eb;
  text-decoration:none;
  padding:6px 10px;
  border-radius:999px;
  background:rgba(15,23,42,0.85);
  border:1px solid #374151;
  box-shadow:0 6px 16px rgba(15,23,42,0.7);
  white-space:nowrap;
}
.back-home:hover{
  background:rgba(31,41,55,0.95);
}
.back-home span.icon{
  font-size:1rem;
}

 

    
    h1{
      text-align:center;
      margin:0 0 6px;
      font-size:1.9rem;
      letter-spacing:.08em;
      text-transform:uppercase;
      color:#f9fafb;
      text-shadow:0 0 10px rgba(248,250,252,0.2),
                  0 0 25px rgba(248,113,113,0.35);
    }

    .subtitle{
      text-align:center;
      font-size:.9rem;
      color:var(--text-muted);
      margin:0 0 14px;
      padding:0 8px;
    }

    .tagline{
      text-align:center;
      font-size:.78rem;
      color:var(--accent-soft);
      text-transform:uppercase;
      letter-spacing:.16em;
      margin-bottom:18px;
    }

    #status{
      text-align:center;
      font-size:.85rem;
      color:var(--text-muted);
      margin-bottom:10px;
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
      gap:14px;
    }

    /* Su telefono: una colonna per leggere e cliccare più facilmente */
    @media (max-width:600px){
      .grid{
        grid-template-columns:1fr;
      }
      body{
        padding:16px 8px 24px;
      }
      h1{
        font-size:1.7rem;
      }
    }

    .cell{
      position:relative;
      background:radial-gradient(circle at top left,#111827 0,#020617 55%,#020617 100%);
      border-radius:18px;
      padding:12px 12px 10px;
      border:1px solid var(--border);
      box-shadow:0 10px 24px rgba(15,23,42,.75);
      overflow:hidden;
      min-height:140px;
      display:flex;
      flex-direction:column;
      justify-content:flex-start;
      align-items:stretch;
    }

    .day-number{
      font-size:1.05rem;
      font-weight:700;
      color:var(--accent-soft);
      margin-bottom:4px;
      text-transform:uppercase;
      letter-spacing:.06em;
    }

    .door-content{
      opacity:0;
      transform:translateY(8px);
      transition:opacity .22s ease, transform .22s ease;
      font-size:.9rem;
    }

    .cell.open .door-content{
      opacity:1;
      transform:translateY(0);
    }

    .title{
      font-weight:700;
      color:#f9fafb;
      margin-bottom:2px;
    }

    .artist{
      color:#f97316;
      font-size:.9rem;
      margin-bottom:6px;
    }

    .proposed-by{
      font-size:.78rem;
      color:var(--text-muted);
      margin-bottom:4px;
    }

    .listen-link{
      display:inline-flex;
      align-items:center;
      gap:6px;
      margin-top:4px;
      font-size:.9rem;
      font-weight:600;
      text-decoration:none;
      color:#38bdf8;
      padding:6px 9px;
      border-radius:999px;
      background:rgba(15,23,42,0.8);
    }
    .listen-link::before{
      content:"▶";
      font-size:.7rem;
    }
    .listen-link:hover{
      text-decoration:none;
      background:rgba(30,64,175,0.9);
    }

    .empty{
      font-size:.8rem;
      color:var(--text-muted);
    }

    /* Porte */
    .door{
      position:absolute;
      inset:0;
      border:none;
      cursor:pointer;
      background:linear-gradient(135deg,#7f1d1d 0,#b91c1c 45%,#f97316 100%);
      color:#f9fafb;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:1.2rem;
      font-weight:800;
      letter-spacing:.16em;
      text-transform:uppercase;
      transition:
        transform .18s ease,
        opacity .24s ease,
        box-shadow .18s ease,
        background .18s ease,
        filter .18s ease;
      box-shadow:0 16px 36px rgba(127,29,29,.85);
      border-radius:18px;
      text-shadow:0 0 10px rgba(248,250,252,.35);
      padding:0 8px;
      text-align:center;
    }

    .door:hover:not(.door-locked):not(:disabled){
      transform:translateY(-1px) scale(1.01);
      box-shadow:0 22px 48px rgba(127,29,29,.95);
      filter:brightness(1.05);
    }

    .door:active:not(.door-locked):not(:disabled){
      transform:translateY(0) scale(.99);
      box-shadow:0 12px 30px rgba(127,29,29,.7);
    }

    .door-open{
      opacity:0;
      pointer-events:none;
    }

    .door-locked{
      cursor:default;
      background:repeating-linear-gradient(
        135deg,
        #020617,
        #020617 10px,
        #111827 10px,
        #111827 20px
      );
      box-shadow:0 14px 34px rgba(15,23,42,.9);
      font-size:1rem;
      letter-spacing:.12em;
      text-shadow:none;
    }

    .cell.open .door{
      opacity:0;
      pointer-events:none;
    }

    .notice{
      text-align:center;
      font-size:.78rem;
      color:var(--text-muted);
      margin-top:16px;
      padding:0 10px;
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="page-header">
      <h1>Muzik in Avent</h1>
      <a href="avent-home.html" class="back-home">
        <span class="icon">←</span>
        <span>Home</span>
      </a>
    </div>

    <p class="subtitle">
      Un titre par jour jusqu’à la fin du mois. Les cases futures restent fermées, seuls les jours déjà débloqués peuvent être ouverts.
    </p>
    <p class="tagline">Calendrier musical – version française</p>

    <p id="status">Chargement du calendrier…</p>

    <div id="calendar" class="grid"></div>

    <p class="notice">
      Les morceaux sont chargés depuis une feuille Google Sheets commune
      (<strong>Giorno, Titolo, Artista, Proposto da, URL</strong>).
      L’état des cases ouvertes est enregistré sur cet appareil (localStorage).
    </p>
  </div>

  <script>
    // Même feuille que la version italienne
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRbB8anD_KDj7SJ_2zoUdRQsVSEl5HSoOe20m4PGYB73BqnJ9Kx5HS2dfokbOMeQiIQJJPzRvo1N3xv/pub?output=csv';

    // Clé localStorage pour cette version FR
    const STORAGE_KEY = 'rockInAvent_fr_openDays_v1';

    const FIRST_DAY = 1;
    const LAST_DAY  = 31;

    function loadOpenDays(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed)) return [];
        return parsed
          .map(n => parseInt(n, 10))
          .filter(n => !isNaN(n));
      }catch(e){
        return [];
      }
    }

    function saveOpenDays(days){
      try{
        const unique = Array.from(new Set(days)).sort((a,b) => a - b);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(unique));
      }catch(e){
        // se localStorage è disabilitato, ignoriamo
      }
    }

    function parseCSV(text){
      const rows = text.trim().split(/\r?\n/);
      if (rows.length === 0) return [];

      const headers = rows[0].split(',').map(h =>
        h.replace(/^"|"$/g, '').trim()
      );

      return rows.slice(1).map(line => {
        const cols = line.split(',');
        const obj = {};
        headers.forEach((h, i) => {
          obj[h] = (cols[i] || '').replace(/^"|"$/g, '').trim();
        });
        return obj;
      });
    }

    async function renderCalendar(){
      const statusEl = document.getElementById('status');
      const container = document.getElementById('calendar');
      let openDays = loadOpenDays();

      try{
        const resp = await fetch(csvUrl);
        if (!resp.ok) throw new Error('HTTP ' + resp.status);
        const text = await resp.text();
        const data = parseCSV(text);

        // Mappa Giorno → riga
        const byDay = {};
        data.forEach(row => {
          const d = parseInt(row['Giorno'], 10);
          if (!isNaN(d)) byDay[d] = row;
        });

        const now = new Date();
        const todayDay = now.getDate();    // 1–31
        const todayMonth = now.getMonth(); // 0–11 (0 = janvier, 11 = décembre)

        container.innerHTML = '';

        for (let day = FIRST_DAY; day <= LAST_DAY; day++){
          const info = byDay[day];

          const cell = document.createElement('div');
          cell.className = 'cell';

          const dayEl = document.createElement('div');
          dayEl.className = 'day-number';
          dayEl.textContent = 'Jour ' + day;
          cell.appendChild(dayEl);

          const content = document.createElement('div');
          content.className = 'door-content';

          if (info){
            const titolo = info['Titolo'] || '';
            const artista = info['Artista'] || '';
            const proposto = info['Proposto da'] || '';
            const url = info['URL'] || '';

            content.innerHTML = `
              <div class="title">${titolo}</div>
              <div class="artist">${artista}</div>
              ${proposto ? `<div class="proposed-by">Proposé par : ${proposto}</div>` : ''}
              ${url ? `<a class="listen-link" href="${url}" target="_blank" rel="noopener">Écouter le morceau</a>` : ''}
            `;
          } else {
            content.innerHTML = `<div class="empty">Aucun morceau renseigné pour ce jour.</div>`;
          }

          cell.appendChild(content);

          const door = document.createElement('button');
          door.type = 'button';
          door.className = 'door';

          // Giorni futuri bloccati solo in dicembre
          const isFuture = (todayMonth === 11 && day > todayDay);

          const isOpen = !isFuture && openDays.includes(day);

          if (isFuture){
            // Jour futur : verrouillé ma con "9 décembre", "10 décembre", ecc.
            door.classList.add('door-locked');
            door.disabled = true;
            door.textContent = day + ' décembre';
            door.title = `Disponible le ${day} décembre`;
          } else {
            if (isOpen){
              // Déjà ouvert sur cet appareil
              cell.classList.add('open');
              door.classList.add('door-open');
              door.disabled = true;
            } else {
              // Jour déblocable (≤ aujourd’hui)
              door.textContent = (day === todayDay) ? 'OUVRIR' : (day + ' décembre');
              door.addEventListener('click', () => {
                cell.classList.add('open');
                door.classList.add('door-open');
                door.disabled = true;

                openDays.push(day);
                saveOpenDays(openDays);
              });
            }
          }

          cell.appendChild(door);
          container.appendChild(cell);
        }

        statusEl.textContent = '';
      } catch(err){
        console.error(err);
        statusEl.textContent = 'Impossible de charger le calendrier. Vérifiez l’URL du CSV.';
        statusEl.style.color = '#fecaca';
      }
    }

    window.addEventListener('DOMContentLoaded', renderCalendar);
  </script>
</body>
</html>





